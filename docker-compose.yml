version: '3.8'

services:
  # R + Python 分析环境
  analysis-env:
    build:
      context: ./docker
      dockerfile: Dockerfile
    container_name: bioclaw-analysis
    ports:
      - "8787:8787"  # RStudio Server
      - "8888:8888"  # JupyterLab
    volumes:
      - ./data:/home/rstudio/data
      - ./outputs:/home/rstudio/outputs
      - ./skills:/home/rstudio/skills
    environment:
      - PASSWORD=bioclaw
      - ROOT=TRUE
    restart: unless-stopped
    networks:
      - bioclaw-network

  # OpenClaw Gateway (飞书/Slack 机器人)
  openclaw:
    image: ghcr.io/openclaw/openclaw:latest
    container_name: bioclaw-openclaw
    ports:
      - "18789:18789"  # Gateway WebSocket
    volumes:
      - ./openclaw-config:/root/.openclaw
      - ./skills:/root/.openclaw/workspace/skills:ro
    environment:
      - OPENCODE_URL=http://host.docker.internal:4096
    restart: unless-stopped
    networks:
      - bioclaw-network
    # 需要飞书/Slack token 配置才能正常工作

networks:
  bioclaw-network:
    driver: bridge
